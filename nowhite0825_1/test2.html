<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>test</title>
</head>
<body>
	<div id="wrap">
		<canvas style="width:100%;height:100%" width="1000" height="600" id="test"></canvas>
	</div>
</body>
<script src="183.js"></script>
<script src="http://s3.qhimg.com/static/2cf8bd87a8b17759/hidpiCanva.js"></script>
<script>
function Falling(tag_id , params){
	var canvas = document.getElementById(tag_id);
	var _this = this;
	_this.falling = {
		canvas: {
			el: canvas,
			w: canvas.offsetWidth,
			h: canvas.offsetHeight
		},
		spirit: {
			clearColor: 'rgba(255, 255, 255, 0.5)',
			shape: {
				isimg: true,
				src: 'http://pic.58pic.com/58pic/15/30/52/29s58PIC2gf_1024.jpg',
				width: 2,
				height: 1,
				type: 'line',
				color: 'hsl(100, 100%, 62%)',
				a: 1
			},
			num: {
				random: true,
				value: '',
				max: 20,
				min: 1
			},
			move: {
				x: random(0, canvas.offsetWidth),
				y: 0,
				angle: 90,
				v: 10,
				hit: random(canvas.innerHeight * .8, canvas.innerHeight * .9)
			},
			animate: {
				bumb:{
					value: true,
					pxpm: canvas.offsetWidth/20,
					collarg: 0.8
				},
				rain: {
					value: '',
					a: 1,
					va: .96
				}
			}
		},
		clearColor: 'rgba(255, 255, 255, 0.5)',
		g: 9.8
	};
	_this.falling.initCanvas();
	_this.falling.canvasSize();
	_this.falling.spiDraw();
};
	Falling.prototype = {
		constructor:Falling,
		initCanvas: function(){
			var _this = this;
			_this.canvas.ctx = _this.canvas.el.getContext('2d');
		},
		
		canvasSize: function(){
			var _this = this;
			_this.canvas.el.width = _this.canvas.width;
			_this.canvas.el.height = _this.canvas.height;
		},
		/*绘制质点*/
		spiDraw: function(){
			var _this = this;
			if(_this.animate.rain.value){
				if (_this.spirit.move.y > _this.spirit.move.hit){
					_this.bezierDraw();
				}
			}
			if(_this.spirit.shape.isimg){
				var img = new Image();
				img.src = _this.spirit.shape.src;
				img.onload = function(){
					_this.canvas.ctx.drawImage(img,_this.spirit.move.x,_this.spirit.move.y,_this.spirit.shape.width,_this.spirit.shape.height);
				}
			} else {
				_this.canvas.ctx.fillStyle = _this.spirit.shape.color;
				_this.canvas.ctx.fillRect(_this.spirit.move.x,_this.spirit.move.y, _this.spirit.shape.width, _this.spirit.shape.height);
			}
			_this.spiFall();
		},
		/*绘制波纹*/
		bezierDraw: function(){
			_this.canvas.ctx.beginPath();
			_this.canvas.ctx.moreTo(_this.spirit.move.x,_this.spirit.move.y - _this.spirit.shape.height/2);
			
		},
		
		spiFall: function(){
			var _this = this;
			var interiorAngle = Math.PI - Math.PI * _this.spirit.move.angle / 180;
			_this.spirit.move.vx = Math.cos(interiorAngle) * _this.spirit.move.v;
			_this.spirit.move.vy = Math.sin(interiorAngle) * _this.spirit.move.v;
			if(_this.spirit.move.y < _this.spirit.move.hit){
				_this.spirit.move.y += _this.spirit.move.vy;
				_this.spirit.move.x += _this.spirit.move.vx;
			} else {
				console.log('finish');
			}
		}
	};
function random(min, max) {
    return Math.random() * (max - min) + min;
}
window.drops = [];
new Falling('test');
</script>
</html>